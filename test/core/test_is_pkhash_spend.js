const {equal} = require('tap');

const isPublicKeyHashSpend = require('../../swaps/is_pkhash_spend');
const {Transaction} = require('../../tokenslib/index');

const {fromHex} = Transaction;

const fixtures = {
  np2wkh_transaction: {
    expected: true,
    tx: '01000000000101446162d25ebffdcdf6cd29170453128e0a52f52d0d0068066abc8d38e5fba1b50000000017160014a6a5276373dfe272bbc26194cf6e5cb5fdb86b8fffffffff021b5f3400000000001600146ef02337779bafe524aec4651e181725a37ccabb55a1ee0000000000220020876f61e1b8a233833c76f7b31a9fe3ae682750b0dc97c2388f8a04078c8a758c02473044022027183248af903136e13cb26509ae82e892a6a87585087bf1a9c8f409a5cc49320220211fcee3fd681feec5862496df3877cf09858c41358fcc083f46691b2925f3ea012103127edaf813ebd7196cbf862258918b7bb15f0b86f55faf4be9200ab426f06b4800000000',
  },
  p2pkh_transaction: {
    expected: true,
    tx: '0100000001545478a76b5484f187b098ee64dbb096f37afb42b45840fabaa9dcf8541a234c000000006b4830450221008e48e7d4ba9e03fe6846e407db712693221d5ee25dedbc74e9de2e2cfda3296902203042048eb45cc493bb9bee5712537e1846ead166e929a840f9c961184dcb74c6012102fbb68ad93ff5b799c72f59369e4a4f18a8a05e93500d1be9ae624b47feeb4d45feffffff0118410803000000001976a91413f1e2987bea6d20d90f82ed7e5823a54393104488ac8cf70700',
  },
  p2sh_transaction: {
    expected: false,
    tx: '0200000001b72a74559342a3963abe5f8e4f8028981b4892134b9b2483fa6bcf1ccc4dc2e001000000d90047304402201a98412d5a6c45f4aa71ecbffece861f02ef23678a72b410fce8db091903d55702206f9be47f1bc9f14adcba4d15a9c379dba0f9757a1a51211b007350e3f5b66c6d01473044022058c56101c7d9d0e93583b54ecabfa7467f590c5aab23455d5a464a65227b5be50220634eb445bd177a1c72b5437b7ad0b4b5aab3ef7c7d07f28882f7bf028fdd376401475221038934160de8ad1dd529329f5bf51e3086cc0f6d19e10fb4120385f23d871c0c1d21021659435e23e3891d39ec2b0266b3c14a68cb4e45adb8543f31508310c98722d952aeffffffff020057a616000000001976a9143d62a85e2f6cdad448d01030c4fd635bec3763f588acd27213e81400000017a91486ed17bfa7bd80cf87cf7e80abd9289079b78c5b8700000000',
  },
  p2wkh_transaction: {
    expected: true,
    tx: '010000000001014f1069454ff2e3290a1c28243ea60c6cdc9fb2043d42dd398b52ac99e1eae1ea0100000000ffffffff02c0c62d0000000000220020d44bd70ed7ba8b4c8311c2146282cdd6dc8ba80641f57c55b508114f49c533f9c870b100000000001600148f5295e17beed4c0485416f05d309b5c84292e570247304402201549bd6f58fbecb09a63a61c1f360f487166b855373ed5aa68f4dc2373cd221502200e32684b49cdec1971a9faa3ec266e673351b031d0c7b9795b01a7ab2c039a8a0121025bae44fe508b0dfbd524f1717f484733ed3aa5c0c2c42aff148fd1af80b9ca7500000000',
  },
  p2wsh_transaction: {
    expected: false,
    tx: '010000000001011be185bb8180cce6fff001c95f5e8d44e6804e7a8a6276cfc80a63ca18307fd40900000000ffffffff02408af7010000000017a9144b3f05cdeef067a60b042dfa682e1f8ee200bc7f8704a2710600000000220020701a8d401c84fb13e6baf169d59684e17abd9fa216c8cc5b9fc63d622ff8c58d0400483045022100e9aa0c6c19c73bc8ebc80d29f1efeca84cf8eaad6234e28795a623a7dc6cf78302202b9a1b02926e59da04b7406f5699af844d51648f91548331179cfa660fe296cc01483045022100e58a05d086eb745bf4e1b70efe0c0a31b33b05c505fb919f5cf0ffaf86d9c63302206b181ef5e63a1caa2fb71fccdf0a18f2b0e3976d8be179e17387a2501a692a90016952210375e00eb72e29da82b89367947f29ef34afb75e8654f6ea368e0acdfd92976b7c2103a1b26313f430c4b15bb1fdce663207659d8cac749a0e53d70eff01874496feff2103c96d495bfdd5ba4145e3e046fee45e84a8a48ad05bd8dbb395c011a32cf9f88053ae00000000',
  },
};

const fixturesToTest = [
  fixtures.np2wkh_transaction,
  fixtures.p2pkh_transaction,
  fixtures.p2sh_transaction,
  fixtures.p2wkh_transaction,
  fixtures.p2wsh_transaction,
];

fixturesToTest.forEach(({expected, tx}) => {
  const [{script, witness}] = fromHex(tx).ins;

  equal(isPublicKeyHashSpend({script, witness}), expected);

  return;
});

